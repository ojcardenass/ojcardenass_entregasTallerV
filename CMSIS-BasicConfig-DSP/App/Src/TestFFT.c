/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Oscar Julián Cárdenas Sosa
 * @brief          : Main program body
 ******************************************************************************

 */

#include <stdint.h>
#include <stm32f4xx.h>

#include "GPIOxDriver.h"
#include "arm_math.h"

#define SIZE_FFT 512


float32_t fft_input[SIZE_FFT];
float32_t fft_output[SIZE_FFT];

// Find the maximum value in the fft_output buffer
float32_t max_value;
uint32_t max_index;

arm_rfft_fast_instance_f32 fft_instance;

float32_t samples[512] = {
    0.707, 0.924, 0.383, -0.924, -0.707, 0.000, 0.707, 0.383,
    -0.707, -0.383, 0.000, 0.383, 0.707, 0.924, 0.000, -0.924,
    -0.707, 0.383, 0.707, -0.383, -0.707, 0.000, 0.707, 0.924,
    -0.383, -0.924, 0.707, 0.000, -0.707, -0.383, 0.707, -0.924,
    -0.707, 0.383, 0.000, -0.383, 0.707, -0.924, 0.000, 0.924,
    -0.707, -0.383, -0.707, 0.383, -0.707, -0.924, 0.383, 0.000,
    0.707, -0.924, -0.383, 0.924, 0.707, 0.000, -0.707, 0.383,
    0.707, 0.924, 0.000, -0.924, 0.707, -0.383, -0.707, -0.383,
    0.707, -0.924, -0.707, -0.383, -0.000, 0.383, -0.707, 0.924,
    0.707, -0.383, 0.000, 0.383, -0.707, -0.924, 0.707, 0.383,
    -0.707, 0.383, -0.000, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383, 0.707, -0.383,
    -0.707, -0.924, 0.383, 0.000, -0.707, 0.924, 0.383, -0.924,
    -0.707, -0.000, 0.707, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, 0.383, -0.707, -0.383, -0.707, -0.924, 0.383, 0.000,
    0.707, -0.924, -0.383, 0.924, 0.707, -0.000, -0.707, 0.383,
    0.707, 0.924, 0.000, -0.924, -0.707, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383, 0.707, -0.383,
    -0.707, -0.924, 0.383, 0.000, -0.707, 0.924, 0.383, -0.924,
    -0.707, -0.000, 0.707, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383, 0.707, -0.383,
    -0.707, -0.924, 0.383, 0.000, -0.707, 0.924, 0.383, -0.924,
    -0.707, -0.000, 0.707, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383, 0.707, -0.383,
    -0.707, -0.924, 0.383, 0.000, -0.707, 0.924, 0.383, -0.924,
    -0.707, -0.000, 0.707, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383, 0.707, -0.383,
    -0.707, -0.924, 0.383, 0.000, -0.707, 0.924, 0.383, -0.924,
    -0.707, -0.000, 0.707, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383, 0.707, -0.383,
    -0.707, -0.924, 0.383, 0.000, -0.707, 0.924, 0.383, -0.924,
    -0.707, -0.000, 0.707, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383, 0.707, -0.383,
    -0.707, -0.924, 0.383, 0.000, -0.707, 0.924, 0.383, -0.924,
    -0.707, -0.000, 0.707, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383, 0.707, -0.383,
    -0.707, -0.924, 0.383, 0.000, -0.707, 0.924, 0.383, -0.924,
    -0.707, -0.000, 0.707, -0.383,0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383, 0.707, -0.383,
    -0.707, -0.924, 0.383, 0.000, -0.707, 0.924, 0.383, -0.924,
    -0.707, -0.000, 0.707, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383, 0.707, -0.383,
    -0.707, -0.924, 0.383, 0.000, -0.707, 0.924, 0.383, -0.924,
    -0.707, -0.000, 0.707, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383, 0.707, -0.383,
    -0.707, -0.924, 0.383, 0.000, -0.707, 0.924, 0.383, -0.924,
    -0.707, -0.000, 0.707, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383, 0.707, -0.383,
    -0.707, -0.924, 0.383, 0.000, -0.707, 0.924, 0.383, -0.924,
    -0.707, -0.000, 0.707, -0.383, 0.707, 0.924, 0.000, -0.924,
    0.707, -0.383, -0.707, -0.383, 0.707, -0.924, -0.707, 0.383,
    -0.000, -0.383, 0.707, 0.924, -0.707, 0.383
    };

int main(void){

	arm_rfft_fast_init_f32(&fft_instance, SIZE_FFT);
	// fill input array with your samples
	for (int i = 0; i < SIZE_FFT; i++) {
	    fft_input[i] = samples[i];
	}
	arm_rfft_fast_f32(&fft_instance, fft_input, fft_output, 0);
	// Calculate the magnitude of the complex numbers
	arm_cmplx_mag_f32(fft_output, fft_output, SIZE_FFT/2);

	arm_max_f32(fft_output, SIZE_FFT/2, &max_value, &max_index);

	// The max_value variable now contains the maximum value in the fft_output buffer

}
